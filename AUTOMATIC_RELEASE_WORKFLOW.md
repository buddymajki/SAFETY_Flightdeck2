# ðŸš€ FULLY AUTOMATIC RELEASE WORKFLOW

## âœ¨ MostantÃ³l TELJESEN AUTOMATIKUS!

EzutÃ¡n **CSAK 4 lÃ©pÃ©s kell:**

```
1. pubspec.yaml verziÃ³ frissÃ­tÃ©s
   â†“
2. dart bin/update_version.dart
   â†“
3. flutter build apk --release
   â†“
4. git push + git tag
   â†“
   âœ… AUTOMATIKUS: Release + APK + metadata.json uploaded!
```

---

## ðŸ“ DETAILED WORKFLOW

### Step 1: Update Version
```yaml
# pubspec.yaml
version: 1.0.5+2  # Change this
```

### Step 2: Auto-Sync Everything
```bash
dart bin/update_version.dart
```

**Ez automatikusan:**
âœ… FrissÃ­ti `lib/services/app_version_service.dart`  
âœ… FrissÃ­ti `metadata.json` (verziÃ³ + GitHub download URL)

### Step 3: Build APK
```bash
flutter build apk --release
```

### Step 4: Push to GitHub
```bash
git add .
git commit -m "Release v1.0.5"
git push origin master
```

### Step 5: Create Release Tag (Triggers GitHub Actions!)
```bash
git tag v1.0.5
git push origin --tags
```

### Step 6: GitHub Actions (AUTOMATIKUS!)

GitHub Actions automatikusan:
âœ… LÃ©trehozza a release-t (`v1.0.5`)  
âœ… Buildel Flutterben  
âœ… FeltÃ¶lti az APK-t a release-be

---

## âš™ï¸ HOW IT WORKS

### A Script (update_version.dart)
```dart
pubspec.yaml: version: 1.0.5+2
        â†“ (reads)
Parses: 1.0.5 + 2
        â†“ (generates)
AppVersionService: const String _appVersion = '1.0.5';
metadata.json: {
  "version": "1.0.5",
  "downloadUrl": "https://github.com/.../v1.0.5/app-release.apk",
  ...
}
```

### GitHub Actions (release.yml)
```
git push â†’ GitHub detects (master branch)
        â†“
Builds Flutter APK
        â†“
GitHub Actions creates Release
        â†“
Uploads APK to release
        â†“
âœ… Release is live!
```

### What the app does
```
App starts
        â†“
Downloads metadata.json from GitHub (raw)
        â†“
Parses version + downloadUrl
        â†“
If new version: Show update dialog
        â†“
User clicks "Update"
        â†“
Downloads from GitHub Release (direct link)
        â†“
âœ… APK installs!
```

---

## ðŸŽ¯ COMPLETE CHECKLIST FOR EACH RELEASE

### Phase 1: Development (Local)
- [ ] Make code changes
- [ ] Test locally
- [ ] Update `pubspec.yaml` version: `1.0.5+2`

### Phase 2: Prepare Release
```bash
# Terminal
dart bin/update_version.dart          # Auto-sync everything
flutter build apk --release           # Build APK
```
- [ ] `metadata.json` is updated âœ… (auto)
- [ ] `app_version_service.dart` is updated âœ… (auto)
- [ ] APK is built âœ…

### Phase 3: Push to GitHub
```bash
git add .
git commit -m "Release v1.0.5"
git push origin master
```
- [ ] Files pushed to GitHub

### Phase 4: Create Release Tag (Triggers GitHub Actions)
```bash
git tag v1.0.5
git push origin --tags
```
- [ ] Tag created and pushed
- [ ] GitHub Actions workflow triggered
### Phase 5: GitHub Actions (AUTOMATIC!)
- [ ] Check: GitHub â†’ Actions â†’ Release workflow running
- [ ] Wait ~5-10 minutes for build
- [ ] Check: GitHub â†’ Releases â†’ New release with APK

### Phase 6: Users Get Update!
- [ ] Users open app
- [ ] Metadata.json downloaded from GitHub
- [ ] Update dialog appears
- [ ] Users install new version

---

## ðŸ“Š FILES OVERVIEW

| File | What | Auto-Updated? |
|------|------|---|
| `pubspec.yaml` | Version source | âŒ Manual |
| `metadata.json` | Release info | âœ… Yes |
| `app_version_service.dart` | App version const | âœ… Yes |
| `lib/screens/main_navigation.dart` | Metadata URL | âœ… Constant |
| GitHub Release | APK hosting | âœ… GitHub Actions |

---

## ðŸ” IMPORTANT NOTES

### metadata.json is NOW on GitHub!
- Location: `metadata.json` in repo root
- URL: `https://raw.githubusercontent.com/buddymajki/SAFETY_Flightdeck2/master/metadata.json`
- This URL **NEVER CHANGES** âœ…
- Is auto-generated by script âœ…

### GitHub Release URL Structure
```
https://github.com/buddymajki/SAFETY_Flightdeck2/releases/download/vX.Y.Z/app-release.apk
```
- versionbÅ‘l jÃ¶n  
- ErrÅ‘l tÃ¶ltÃ¶dik le az APK  
- GitHub automatikusan generÃ¡lja

### No More Manual Steps!
âŒ GONE: Manual Google Drive uploads  
âŒ GONE: Manual metadata.json editing  
âŒ GONE: Firestore updates  

âœ… NEW: One command syncs everything  
âœ… AUTOMATIC: GitHub Actions releases  
âœ… AUTOMATIC: Users get updates  

---

## âœ¨ THE MAGIC

**Before:**
```
pubspec â†’ Manual build â†’ Manual upload Drive â†’ Manual metadata edit â†’ Firestore update
```
âŒ 15 manual steps, error-prone

**Now:**
```
pubspec â†’ dart bin/update_version.dart â†’ flutter build apk --release â†’ git push â†’ git tag â†’ GitHub Actions
```
âœ… 4 commands, EVERYTHING else automatic!

---

## ðŸš€ QUICK START NEXT RELEASE

```bash
# 1. Edit pubspec.yaml (version: 1.0.5+2)

# 2. Sync + Build
dart bin/update_version.dart
flutter build apk --release

# 3. Push to GitHub
git add .
git commit -m "Release v1.0.5"
git push origin master

# 4. Create Release Tag (Triggers GitHub Actions!)
git tag v1.0.5
git push origin --tags

# ðŸ¤– Watch GitHub Actions do its magic! ðŸŽ‰
# â†’ GitHub â†’ Actions â†’ Releases tab
```

---

## ðŸ†˜ TROUBLESHOOTING

### Q: GitHub Actions not triggering?
- Make sure you pushed to `master` branch
- Check: GitHub â†’ Actions â†’ Workflows file exists
- Check: `.github/workflows/release.yml` is in repo

### Q: APK not uploading to release?
- Check: GitHub â†’ Actions â†’ Build log
- Common: Flutter build failed â†’ Check `flutter build apk --release` locally
- Fix: Run `flutter pub get` before building

### Q: metadata.json wrong format?
- Script auto-generates it
- Check: `dart bin/update_version.dart` output
- Should see: âœ… metadata.json updated successfully!

### Q: App not seeing new version?
- Check: metadata.json in repo
- Check: Version in JSON > current app version
- Wait: App checks on startup
- Restart: Force close + reopen app

---

## ðŸ“š RELATED FILES

- **GitHub Actions:** `.github/workflows/release.yml`
- **Version Sync Script:** `bin/update_version.dart`
- **Metadata Template:** `metadata.json`
- **App Integration:** `lib/screens/main_navigation.dart`
- **Version Service:** `lib/services/app_version_service.dart`

---

## ðŸŽ‰ YOU'RE ALL SET!

Everything is now **100% automatic** except:
- Editing `pubspec.yaml` (manual)
- Running `flutter build apk --release` (manual)
- `git push` (manual)

Everything else? ðŸ¤– **AUTOMATIC!**

**LegkÃ¶zelebb: Edit pubspec â†’ Build â†’ Push â†’ KÃ©sz!** ðŸš€
